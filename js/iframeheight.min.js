/*
 Jquery Iframe Auto Height Plugin
 Version 1.2.5 (09.10.2013)

 Author : Ilker Guller (http://ilkerguller.com)

 Description: This plugin can get contents of iframe and set height of iframe automatically. Also it has cross-domain fix (*).
 Details: http://github.com/Sly777/Iframe-Height-Jquery-Plugin
 */
!function(a){var b=0,c={resizeMaxTry:4,resizeWaitTime:50,minimumHeight:200,defaultHeight:3e3,heightOffset:0,exceptPages:"",debugMode:!1,visibilitybeforeload:!1,blockCrossDomain:!1,externalHeightName:"bodyHeight",onMessageFunctionName:"getHeight",domainName:"*",watcher:!1,watcherTime:400};a.iframeHeight=function(c,d){var e=this;a.iframeHeight.resizeTimeout=null,a.iframeHeight.resizeCount=0,e.$el=a(c),e.el=c,e.$el.before("<div id='iframeHeight-Container-"+b+"' style='padding: 0; margin: 0; border: none; background-color: transparent;'></div>"),e.$el.appendTo("#iframeHeight-Container-"+b),e.$container=a("#iframeHeight-Container-"+b),e.$el.data("iframeHeight",e),e.watcher=null,e.debug={FirstTime:!0,Init:function(){"console"in window||(console={}),"log info warn error dir clear".replace(/\w+/g,function(a){a in console||(console[a]=console.log||new Function)})},Log:function(a){this.FirstTime&&this.FirstTime===!0&&(this.Init(),this.FirstTime=!1),e.options.debugMode&&e.options.debugMode===!0&&console&&(null!==a||""!==a)&&console.log("Iframe Plugin : "+a)},GetBrowserInfo:function(a){var b,c,d=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browserObj:b[1]||"",version:b[2]||"0"}};return b=d(navigator.userAgent),c={chrome:!1,safari:!1,mozilla:!1,msie:!1,webkit:!1},b.browserObj&&(c[b.browserObj]=!0,c.version=b.version),c.chrome?c.webkit=!0:c.webkit&&(c.safari=!0),a=c}(this.GetBrowserInfo||{})};var f=function(){try{var a;return a=e.debug.GetBrowserInfo.msie&&"7.0"==e.debug.GetBrowserInfo.version?e.$el.get(0).contentWindow.location.href:e.$el.get(0).contentDocument.location.href,e.debug.Log("This page is non-Cross Domain - "+a),!1}catch(b){return e.debug.Log("This page is Cross Domain"),!0}};e.resetIframe=function(){!e.options.visibilitybeforeload||e.debug.GetBrowserInfo.msie&&"7.0"==e.debug.GetBrowserInfo.version||e.$el.css("visibility","hidden"),e.debug.Log("Old Height is "+e.$el.height()+"px"),e.$el.css("height","").removeAttr("height"),e.debug.Log("Reset iframe"),e.debug.Log("Height is "+e.$el.height()+"px after reset")},e.resizeFromOutside=function(a){if(e.options.blockCrossDomain)return e.debug.Log("Blocked cross domain fix"),!1;if("undefined"==typeof a)return!1;if("string"!=typeof a.data)return!1;if("reset"==a.data)e.$el.css("height","").removeAttr("height");else{if(!/^ifh*/.test(a.data))return!1;if("number"!=typeof parseInt(a.data.substring(3)))return!1;var b=parseInt(a.data.substring(3))+parseInt(e.options.heightOffset);e.resetIframe(),e.setIframeHeight(b)}return!0},e.checkMessageEvent=function(){if(e.options.blockCrossDomain||e.debug.GetBrowserInfo.msie&&"7.0"==e.debug.GetBrowserInfo.version)return e.debug.Log("Blocked cross domain fix"),!1;e.resetIframe(),!e.options.visibilitybeforeload||e.debug.GetBrowserInfo.msie&&"7.0"==e.debug.GetBrowserInfo.version||e.$el.css("visibility","visible"),window.addEventListener?window.addEventListener("message",e.resizeFromOutside,!1):window.attachEvent&&window.attachEvent("onmessage",e.resizeFromOutside),e.$el.id||(e.$el.id="iframe-id-"+ ++b);var a=document.getElementById(e.$el.attr("id")),c=e.options.onMessageFunctionName;return a.contentWindow.postMessage?(a.contentWindow.postMessage(c,"*"),e.debug.Log("Cross Domain Iframe started"),!0):(e.debug.Log("Your browser does not support the postMessage method!"),!1)};var g=function(){a.iframeHeight.resizeCount<=e.options.resizeMaxTry?(a.iframeHeight.resizeCount++,a.iframeHeight.resizeTimeout=setTimeout(a.iframeHeight.resizeIframe,e.options.resizeWaitTime),e.debug.Log(a.iframeHeight.resizeCount+" time(s) tried")):(clearTimeout(a.iframeHeight.resizeTimeout),a.iframeHeight.resizeCount=0,e.debug.Log("set default height for iframe"),e.setIframeHeight(e.options.defaultHeight+e.options.heightOffset))};e.sendInfotoTop=function(){if(top.length>0&&"undefined"!=typeof JSON){var b={};b[e.options.externalHeightName].value=a(document).height();var c="*";return b=JSON.stringify(b),top.postMessage(b,c),e.debug.Log("sent info to top page"),!1}return!0},e.setIframeHeight=function(a){e.$el.height(a).css("height",a),e.$el.data("iframeheight")!=a&&e.$container.height(a).css("height",a),!e.options.visibilitybeforeload||e.debug.GetBrowserInfo.msie&&"7.0"==e.debug.GetBrowserInfo.version||e.$el.css("visibility","visible"),e.debug.Log("Now iframe height is "+a+"px"),e.$el.data("iframeheight",a)},a.iframeHeight.resizeIframe=function(){if(e.resetIframe(),f())e.$el.height(e.options.defaultHeight+e.options.heightOffset).css("height",e.options.defaultHeight+e.options.heightOffset),!e.options.visibilitybeforeload||e.debug.GetBrowserInfo.msie&&"7.0"==e.debug.GetBrowserInfo.version||e.$el.css("visibility","visible"),e.checkMessageEvent();else if(e.$el.css("height")===e.options.minimumHeight+"px"&&e.resetIframe(),null!==e.$el.get(0).contentWindow.document.body){e.debug.Log("This page has body info");var b=a(e.$el.get(0).contentWindow.document).height(),c=e.$el.get(0).contentWindow.document.location.pathname.substring(e.$el.get(0).contentWindow.document.location.pathname.lastIndexOf("/")+1).toLowerCase();e.debug.Log("page height : "+b+"px || page name : "+c),b<=e.options.minimumHeight&&-1==e.options.exceptPages.indexOf(c)?g():b>e.options.minimumHeight&&-1==e.options.exceptPages.indexOf(c)&&e.setIframeHeight(b+e.options.heightOffset)}else e.debug.Log("This page has not body info"),g()},this.$el.bind("updateIframe",function(){a.iframeHeight.resizeIframe(),e.debug.Log("Updated Iframe Manually")}),this.$el.bind("killWatcher",function(){window.clearInterval(e.watcher),e.debug.Log("Killed Watcher")}),e.init=function(){return e.options=a.extend({},a.iframeHeight.defaultOptions,d),1==e.options.watcher&&(e.options.blockCrossDomain=!0),e.debug.Log(e.options),void 0===e.$el.get(0).tagName||"iframe"!==e.$el.get(0).tagName.toLowerCase()?(e.debug.Log("This element is not iframe!"),!1):(a.iframeHeight.resizeIframe(),e.$el.load(function(){a.iframeHeight.resizeIframe()}),e.options.watcher&&(e.watcher=setInterval(function(){a.iframeHeight.resizeIframe(),e.debug.Log("Checked Iframe")},e.options.watcherTime)),!0)},e.init()},a.iframeHeight.defaultOptions=c,a.fn.iframeHeight=function(b){return this.each(function(){new a.iframeHeight(this,b)})},a.iframeHeightExternal=function(){function b(b){var d;if("domain"in b&&(d=b.domain),"origin"in b&&(d=b.origin),"*"!==c.domainName&&d!==c.domainName)return a.iframeHeight.debug.Log("It's not same domain. Blocked!"),void 0;if(b.data==c.onMessageFunctionName){var e="ifh"+a(document).height();b.source.postMessage(e,b.origin)}}return 1===arguments.length&&a.isPlainObject(arguments[0])&&(c=arguments[0]),window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent&&window.attachEvent("onmessage",b),{update:function(){this.reset(),window.__domainname=c.domainName,setTimeout(function(){var b="ifh"+a(document).height();parent.postMessage(b,window.__domainname)},90)},reset:function(){parent.postMessage("reset",c.domainName)}}}}(jQuery);